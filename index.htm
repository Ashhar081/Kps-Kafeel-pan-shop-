<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KPS - Welcome Paan Lovers</title>
    <!-- Three.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Google Fonts: Great Vibes for Cursive -->
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
    
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: radial-gradient(circle at center, #2c3e50 0%, #000000 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            touch-action: none; 
            user-select: none; 
        }

        #info {
            position: absolute;
            top: 20px;
            width: 100%;
            text-align: center;
            color: white;
            pointer-events: auto; 
            z-index: 10;
            cursor: default;
        }

        h1 {
            margin: 0;
            font-size: 3rem; /* Top KPS size */
            font-weight: 900;
            letter-spacing: 3px;
            background: linear-gradient(to bottom, #ffeaa7, #fab1a0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
            text-shadow: 0 4px 10px rgba(0,0,0,0.3);
            cursor: pointer; 
            line-height: 1;
        }

        /* New Cursive Text Style */
        .welcome-text {
            font-family: 'Great Vibes', cursive;
            font-size: 3.5rem; /* Big Font */
            color: #ffd700; /* Gold Color */
            margin: 5px 0 10px 0;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
            line-height: 1.2;
            font-weight: normal;
        }

        /* HIDDEN BY DEFAULT - Admin Only */
        #admin-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
            pointer-events: auto;
            display: none; 
        }

        .toggle-btn {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 2px solid #fff;
            color: #fff;
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .toggle-btn.active {
            background: #ffd700;
            color: #000;
            border-color: #ffd700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
        }

        /* Modal Styles */
        .modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(20px);
            padding: 40px;
            border-radius: 20px;
            border: 2px solid #555;
            color: white;
            text-align: center;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s;
            z-index: 1000;
            min-width: 300px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
        }

        .modal.active {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
            pointer-events: auto;
        }

        .modal h2 { margin-top: 0; color: #ffd700; font-size: 2rem; }
        .modal input { width: 100%; padding: 12px; margin: 10px 0; background: #444; border: 1px solid #777; color: white; border-radius: 8px; box-sizing: border-box; font-size: 1rem; }
        
        .file-upload { 
            border: 2px dashed #888; 
            padding: 20px; 
            margin: 15px 0; 
            border-radius: 10px; 
            cursor: pointer; 
            background: rgba(255,255,255,0.05); 
            transition: 0.2s;
        }
        .file-upload:hover { border-color: #ffd700; background: rgba(255,215,0,0.1); }

        .btn { background: linear-gradient(45deg, #ffd700, #ffa502); border: none; color: #000; padding: 12px 30px; border-radius: 25px; cursor: pointer; font-weight: bold; text-transform: uppercase; margin-top: 20px; width: 100%; font-size: 1rem; }
        .btn-cancel { background: #555; color: #fff; margin-top: 10px; }
        #preview-img { width: 120px; height: 120px; object-fit: cover; border-radius: 50%; border: 3px solid #ffd700; margin-top: 10px; display: none; margin-left: auto; margin-right: auto;}
    </style>
</head>
<body>

    <div id="info">
        <!-- Secret Trigger: Click "KPS" 5 times -->
        <h1 id="secret-trigger">KPS</h1>
        
        <!-- NEW CURSIVE TEXT HERE -->
        <div class="welcome-text">Welcome Paan Lovers</div>
        
        <!-- Subtitle removed as requested -->
    </div>

    <!-- Hidden Edit Button -->
    <div id="admin-controls">
        <button id="edit-toggle" class="toggle-btn" onclick="toggleEditMode()">
            <i class="ph ph-pencil-simple"></i> Edit Mode: OFF
        </button>
    </div>

    <div id="edit-modal" class="modal">
        <h2>Edit Item</h2>
        <input type="text" id="edit-name" placeholder="Item Name">
        <input type="text" id="edit-price" placeholder="Price (e.g. â‚¹50)">
        
        <div class="file-upload" onclick="document.getElementById('edit-file').click()">
            <i class="ph ph-image" style="font-size: 2rem; color: #ccc;"></i>
            <p style="margin: 5px 0; font-size: 0.9rem; color: #ccc;">Click to upload PNG (Max 500KB)</p>
            <input type="file" id="edit-file" accept="image/png, image/jpeg, image/jpg" style="display: none" onchange="handleFileSelect(event)">
        </div>
        
        <img id="preview-img" src="" alt="Preview">
        
        <button class="btn" onclick="saveEdit()">Save Changes</button>
        <button class="btn btn-cancel" onclick="closeModals()">Cancel</button>
    </div>

    <script>
        // --- 1. ADMIN LOCK LOGIC ---
        let secretClicks = 0;
        const trigger = document.getElementById('secret-trigger');
        
        trigger.addEventListener('click', () => {
            secretClicks++;
            if(secretClicks === 5) {
                const password = prompt("ðŸ” Admin Access\nEnter Password:");
                if(password === "admin123") { 
                    document.getElementById('admin-controls').style.display = 'block';
                    alert("âœ… Admin Mode Unlocked!");
                } else {
                    alert("âŒ Wrong Password!");
                }
                secretClicks = 0; 
            }
        });

        // --- 2. DATA MANAGEMENT ---
        const defaultProducts = [
            { name: "Sada Paan", price: "â‚¹10", color: "#2ecc71", image: null },
            { name: "Tambaku 00", price: "â‚¹15", color: "#27ae60", image: null },
            { name: "Kimam Special", price: "â‚¹15", color: "#c0392b", image: null },
            { name: "Anniversary Spl", price: "â‚¹50", color: "#f1c40f", image: null },
            { name: "Meetha Paan", price: "â‚¹15", color: "#00b894", image: null }, 
            { name: "Full Meetha", price: "â‚¹25", color: "#00cec9", image: null },
            { name: "KPS Spl Meetha", price: "â‚¹35", color: "#fdcb6e", image: null },
            { name: "Rajnigandha", price: "â‚¹35", color: "#b2bec3", image: null },
            { name: "Dragon Paan", price: "â‚¹30", color: "#d63031", image: null },
            { name: "Chocolate Paan", price: "â‚¹30", color: "#5d4037", image: null },
            { name: "Fire Paan", price: "â‚¹35", color: "#e17055", image: null },
            { name: "Dry Fruits Paan", price: "â‚¹50", color: "#e67e22", image: null }
        ];

        // Using v8 to match previous stable version
        let products = JSON.parse(localStorage.getItem('kps_products_v8')) || defaultProducts;

        function saveToStorage() {
            try {
                localStorage.setItem('kps_products_v8', JSON.stringify(products));
            } catch (e) {
                alert("Storage Full! Photo save nahi ho payi.");
            }
        }

        // --- 3. Scene Setup ---
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x1a252f, 0.012);

        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 15;
        camera.position.y = 2;

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6); 
        scene.add(ambientLight);
        const pointLight = new THREE.PointLight(0xffd700, 1.8, 60);
        pointLight.position.set(0, 5, 8);
        scene.add(pointLight);
        const fillLight = new THREE.DirectionalLight(0xffffff, 0.5);
        fillLight.position.set(-5, 5, 5);
        scene.add(fillLight);

        // Logo
        function createLogo() {
            const canvas = document.createElement('canvas');
            canvas.width = 1024;
            canvas.height = 1024;
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, 1024, 1024);
            ctx.shadowColor = "#ffd700";
            ctx.shadowBlur = 60;
            ctx.fillStyle = "#ffffff";
            ctx.font = "900 250px Arial";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText("KPS", 512, 400);
            ctx.font = "bold 60px Arial";
            ctx.shadowBlur = 20;
            ctx.fillStyle = "#fffa65";
            ctx.fillText("KAFEEL PAN SHOP", 512, 550);
            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.SpriteMaterial({ map: texture });
            const sprite = new THREE.Sprite(material);
            sprite.scale.set(8, 8, 1);
            sprite.position.y = 1;
            scene.add(sprite);
        }
        createLogo();

        // Texture Generator
        function createCardTexture(text, price, baseColor, imageSrc) {
            const canvas = document.createElement('canvas');
            canvas.width = 512;
            canvas.height = 750;
            const ctx = canvas.getContext('2d');
            const texture = new THREE.CanvasTexture(canvas);

            function draw() {
                const grd = ctx.createLinearGradient(0, 0, 0, 750);
                grd.addColorStop(0, baseColor);
                grd.addColorStop(0.6, '#2c3e50');
                grd.addColorStop(1, '#000');
                ctx.fillStyle = grd;
                ctx.beginPath();
                ctx.roundRect(0, 0, 512, 750, 30);
                ctx.fill();
                ctx.lineWidth = 15;
                ctx.strokeStyle = "#ffd700";
                ctx.stroke();
                ctx.fillStyle = "rgba(255, 255, 255, 0.15)";
                ctx.fillRect(20, 20, 472, 710);
                ctx.fillStyle = "#ffd700";
                ctx.font = "bold 30px Arial";
                ctx.textAlign = "center";
                ctx.fillText("â˜… KPS â˜…", 256, 80);
                ctx.fillStyle = "#ffffff";
                const fontSize = text.length > 12 ? "40px" : "50px";
                ctx.font = `bold ${fontSize} Arial`;
                ctx.shadowColor="rgba(0,0,0,0.8)";
                ctx.shadowBlur=4;
                ctx.fillText(text, 256, 520);
                ctx.shadowBlur=0;
                ctx.fillStyle = "#ffd700";
                ctx.beginPath();
                ctx.roundRect(106, 600, 300, 80, 20);
                ctx.fill();
                ctx.fillStyle = "#000000";
                ctx.font = "bold 50px Arial";
                ctx.fillText(price, 256, 655);
                texture.needsUpdate = true;
            }
            draw(); 

            if (imageSrc) {
                const img = new Image();
                img.crossOrigin = "anonymous";
                img.onload = function() {
                    draw(); 
                    ctx.save();
                    ctx.beginPath();
                    ctx.arc(256, 250, 140, 0, Math.PI * 2);
                    ctx.closePath();
                    ctx.clip();
                    ctx.drawImage(img, 116, 110, 280, 280);
                    ctx.restore();
                    texture.needsUpdate = true;
                };
                img.onerror = function() { draw(); }; 
                img.src = imageSrc;
            } else {
                ctx.fillStyle = "rgba(255,255,255,0.2)";
                ctx.beginPath();
                ctx.arc(256, 250, 140, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = "#ffffff";
                ctx.font = "bold 120px serif";
                ctx.fillText(text.charAt(0), 256, 255);
                texture.needsUpdate = true;
            }
            return texture;
        }

        const carouselGroup = new THREE.Group();
        scene.add(carouselGroup);
        const cards = [];
        const radius = 7.5;
        const dummyTarget = new THREE.Object3D();

        function renderCards() {
            cards.forEach(c => carouselGroup.remove(c));
            cards.length = 0;

            products.forEach((product, i) => {
                const angle = (i / products.length) * Math.PI * 2;
                
                const geometry = new THREE.BoxGeometry(2.3, 3.4, 0.1);
                const texture = createCardTexture(product.name, product.price, product.color, product.image);
                
                const matFront = new THREE.MeshStandardMaterial({ map: texture, roughness: 0.1, metalness: 0.2 });
                const matBack = new THREE.MeshStandardMaterial({ map: texture, roughness: 0.1, metalness: 0.2 });
                const matSide = new THREE.MeshStandardMaterial({ color: 0x333333 });
                
                const materials = [matSide, matSide, matSide, matSide, matFront, matBack];

                const card = new THREE.Mesh(geometry, materials);
                
                card.position.x = Math.cos(angle) * radius;
                card.position.z = Math.sin(angle) * radius;
                
                card.lookAt(0, 0, 0);
                card.rotation.y += Math.PI;

                card.userData = { id: i, angle: angle }; 
                carouselGroup.add(card);
                cards.push(card);
            });
        }
        renderCards();

        // --- Interaction & Edit Logic ---
        let isEditMode = false;
        let currentEditIndex = -1;
        let tempImageSrc = null;
        let zoomedCardIndex = -1;

        function toggleEditMode() {
            isEditMode = !isEditMode;
            const btn = document.getElementById('edit-toggle');
            if(isEditMode) {
                btn.innerHTML = '<i class="ph ph-check-circle"></i> Edit Mode: ON';
                btn.classList.add('active');
                zoomedCardIndex = -1;
            } else {
                btn.innerHTML = '<i class="ph ph-pencil-simple"></i> Edit Mode: OFF';
                btn.classList.remove('active');
                closeModals();
            }
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.size > 500 * 1024) { 
                    alert("âš ï¸ Photo too big! Max 500KB.");
                    event.target.value = "";
                    return;
                }
                const reader = new FileReader();
                reader.onload = function(e) {
                    tempImageSrc = e.target.result; 
                    document.getElementById('preview-img').src = tempImageSrc;
                    document.getElementById('preview-img').style.display = 'block';
                }
                reader.readAsDataURL(file);
            }
        }

        function saveEdit() {
            if (currentEditIndex === -1) return;
            const newName = document.getElementById('edit-name').value;
            const newPrice = document.getElementById('edit-price').value;
            products[currentEditIndex].name = newName;
            products[currentEditIndex].price = newPrice;
            if (tempImageSrc) products[currentEditIndex].image = tempImageSrc;
            saveToStorage(); 
            renderCards(); 
            closeModals();
        }

        function closeModals() {
            document.getElementById('edit-modal').classList.remove('active');
            currentEditIndex = -1;
            tempImageSrc = null;
        }

        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        
        let isDragging = false;
        let isPinching = false;
        let previousMouseX = 0;
        let previousMouseY = 0; 
        
        let targetRotation = 0;
        let currentRotation = 0;
        let targetVerticalY = 0; 
        let currentVerticalY = 0;
        
        let autoRotateSpeed = 0.001; 
        let lastMoveTime = 0;
        let initialPinchDistance = 0;

        // MOUSE
        window.addEventListener('mousedown', (e) => { 
            if(e.target.closest('.modal')) return;
            isDragging = true; 
            previousMouseX = e.clientX;
            previousMouseY = e.clientY; 
            autoRotateSpeed = 0; 
        });

        window.addEventListener('mousemove', (e) => {
            mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
            if(isDragging && zoomedCardIndex === -1) { 
                const deltaX = e.clientX - previousMouseX;
                targetRotation += deltaX * 0.005;
                previousMouseX = e.clientX;
                
                const deltaY = e.clientY - previousMouseY;
                targetVerticalY -= deltaY * 0.005;
                targetVerticalY = Math.max(-3, Math.min(targetVerticalY, 3)); 
                previousMouseY = e.clientY;
                lastMoveTime = Date.now();
            }
        });

        window.addEventListener('mouseup', () => {
            isDragging = false;
            if(zoomedCardIndex === -1) setTimeout(() => { if(!isDragging) autoRotateSpeed = 0.001; }, 2000);
        });
        
        // TOUCH (Pinch + Swipe)
        window.addEventListener('touchstart', (e) => { 
            if(e.target.closest('.modal')) return;
            
            if (e.touches.length === 2) {
                isPinching = true;
                isDragging = false;
                autoRotateSpeed = 0;
                const dx = e.touches[0].clientX - e.touches[1].clientX;
                const dy = e.touches[0].clientY - e.touches[1].clientY;
                initialPinchDistance = Math.sqrt(dx * dx + dy * dy);
            } else if (e.touches.length === 1) {
                isDragging = true; 
                isPinching = false;
                previousMouseX = e.touches[0].clientX;
                previousMouseY = e.touches[0].clientY;
                autoRotateSpeed = 0; 
                mouse.x = (e.touches[0].clientX / window.innerWidth) * 2 - 1; 
                mouse.y = -(e.touches[0].clientY / window.innerHeight) * 2 + 1;
            }
        }, {passive: false});

        window.addEventListener('touchmove', (e) => {
            if(e.target.closest('.modal')) return;
            e.preventDefault(); 
            
            if (isPinching && e.touches.length === 2) {
                const dx = e.touches[0].clientX - e.touches[1].clientX;
                const dy = e.touches[0].clientY - e.touches[1].clientY;
                const currentPinchDistance = Math.sqrt(dx * dx + dy * dy);
                const deltaDistance = initialPinchDistance - currentPinchDistance;
                camera.position.z += deltaDistance * 0.05; 
                camera.position.z = Math.max(8, Math.min(camera.position.z, 25));
                initialPinchDistance = currentPinchDistance;
                lastMoveTime = Date.now();

            } else if (isDragging && e.touches.length === 1 && zoomedCardIndex === -1) {
                const deltaX = e.touches[0].clientX - previousMouseX;
                targetRotation += deltaX * 0.005; 
                previousMouseX = e.touches[0].clientX;

                const deltaY = e.touches[0].clientY - previousMouseY;
                targetVerticalY -= deltaY * 0.008; 
                targetVerticalY = Math.max(-3, Math.min(targetVerticalY, 3)); 
                previousMouseY = e.touches[0].clientY;
                lastMoveTime = Date.now();
            }
        }, {passive: false});

        window.addEventListener('touchend', (e) => {
            if (e.touches.length < 2) isPinching = false;
            if (e.touches.length === 0) isDragging = false;
            if(zoomedCardIndex === -1 && !isPinching && !isDragging) {
                setTimeout(() => { if(!isDragging && !isPinching) autoRotateSpeed = 0.001; }, 2000);
            }
        });
        
        // Wheel Zoom
        window.addEventListener('wheel', (e) => {
            if(e.target.closest('.modal')) return;
            camera.position.z += e.deltaY * 0.01;
            camera.position.z = Math.max(8, Math.min(camera.position.z, 25));
        });


        window.addEventListener('click', (event) => {
            if (Date.now() - lastMoveTime < 200) return; 
            if(event.target.closest('.modal') || event.target.closest('#admin-controls') || event.target.closest('#secret-trigger')) return;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(cards);

            if (intersects.length > 0) {
                const index = intersects[0].object.userData.id;
                if (isEditMode) {
                    const product = products[index];
                    currentEditIndex = index;
                    document.getElementById('edit-name').value = product.name;
                    document.getElementById('edit-price').value = product.price;
                    document.getElementById('preview-img').style.display = product.image ? 'block' : 'none';
                    if(product.image) document.getElementById('preview-img').src = product.image;
                    document.getElementById('edit-modal').classList.add('active');
                } else {
                    if (zoomedCardIndex === index) {
                        zoomedCardIndex = -1;
                        autoRotateSpeed = 0.001; 
                    } else {
                        zoomedCardIndex = index;
                        autoRotateSpeed = 0; 
                        targetVerticalY = 0; 
                    }
                }
            } else {
                if (isEditMode) {
                    closeModals();
                } else if (zoomedCardIndex !== -1) {
                    zoomedCardIndex = -1;
                    autoRotateSpeed = 0.001;
                }
            }
        });

        function animate() {
            requestAnimationFrame(animate);
            
            if (!isDragging && !isEditMode && zoomedCardIndex === -1 && !isPinching) targetRotation += autoRotateSpeed;
            
            currentRotation += (targetRotation - currentRotation) * 0.05;
            carouselGroup.rotation.y = currentRotation;
            currentVerticalY += (targetVerticalY - currentVerticalY) * 0.05;
            carouselGroup.position.y = currentVerticalY;
            
            const time = Date.now() * 0.001;
            const camLocal = camera.position.clone().applyMatrix4(carouselGroup.matrixWorld.clone().invert());

            cards.forEach((card, i) => {
                let targetPos = new THREE.Vector3();
                let targetScale = 1;
                let targetQuaternion = new THREE.Quaternion();

                if (i === zoomedCardIndex) {
                    const desiredWorldPos = new THREE.Vector3(0, 1.5 + currentVerticalY, 12); 
                    const inverseGroupMatrix = carouselGroup.matrixWorld.clone().invert();
                    const localTargetPos = desiredWorldPos.clone().applyMatrix4(inverseGroupMatrix);
                    targetPos.copy(localTargetPos);
                    targetScale = 1.4; 
                    dummyTarget.position.copy(localTargetPos);
                    dummyTarget.lookAt(camLocal); 
                    targetQuaternion.copy(dummyTarget.quaternion);
                } else {
                    const angle = card.userData.angle;
                    targetPos.set(
                        Math.cos(angle) * radius,
                        Math.sin(time + i) * 0.2, 
                        Math.sin(angle) * radius
                    );
                    targetScale = 1;
                    dummyTarget.position.copy(targetPos);
                    dummyTarget.lookAt(0, 0, 0);
                    dummyTarget.rotateY(Math.PI);
                    targetQuaternion.copy(dummyTarget.quaternion);
                }
                card.position.lerp(targetPos, 0.1);
                card.scale.lerp(new THREE.Vector3(targetScale, targetScale, targetScale), 0.1);
                card.quaternion.slerp(targetQuaternion, 0.1); 
            });

            renderer.render(scene, camera);
        }
        
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();
    </script>
</body>
</html>


